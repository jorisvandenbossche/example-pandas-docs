

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Computational tools &#8212; pandas 1.0.0rc0+111.ge72cd7c52 documentation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link rel="stylesheet" href="../_static/sphinx-bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pandas.css" />
    <link href="../_static/css/custom.css" rel="stylesheet">
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Group By: split-apply-combine" href="groupby.html" />
    <link rel="prev" title="Visualization" href="visualization.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">

<a class="navbar-brand" href="../index.html">
  <img src="../_static/pandas.svg" class="logo" alt="logo">
</a>

<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
</button>

<div id="navbar-menu" class="collapse navbar-collapse">
  <ul id="navbar-main-elements" class="navbar-nav mr-auto">
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        1.0.0
      </a>
      <div class="dropdown-menu" aria-labelledby="navbarDropdown" id="version-menu"></div>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="../index.html">Home</a>
    </li>
    
    
    <li class="nav-item ">
        <a class="nav-link" href="../whatsnew/v1.1.0.html">What's New in 1.1.0</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../getting_started/index.html">Getting started</a>
    </li>
    
    <li class="nav-item active">
        <a class="nav-link" href="index.html">User Guide</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../reference/index.html">API reference</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../development/index.html">Development</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../whatsnew/index.html">Release Notes</a>
    </li>
    
    
  </ul>
  <ul class="navbar-nav ml-auto">
    
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/pandas-dev/pandas" target="_blank" rel="noopener">
          <span><i class="fab fa-github-square"></i></span>
        </a>
      </li>
    
    
      <li class="nav-item">
        <a class="nav-link" href="https://twitter.com/pandas_dev" target="_blank" rel="noopener">
          <span><i class="fab fa-twitter-square"></i></span>
        </a>
      </li>
    
  </ul>
</div>
    </nav>

    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
        
          
              <li class="">
                  <a href="io.html">IO tools (text, CSV, HDF5, …)</a>
              </li>
          
        
          
              <li class="">
                  <a href="indexing.html">Indexing and selecting data</a>
              </li>
          
        
          
              <li class="">
                  <a href="advanced.html">MultiIndex / advanced indexing</a>
              </li>
          
        
          
              <li class="">
                  <a href="merging.html">Merge, join, and concatenate</a>
              </li>
          
        
          
              <li class="">
                  <a href="reshaping.html">Reshaping and pivot tables</a>
              </li>
          
        
          
              <li class="">
                  <a href="text.html">Working with text data</a>
              </li>
          
        
          
              <li class="">
                  <a href="missing_data.html">Working with missing data</a>
              </li>
          
        
          
              <li class="">
                  <a href="categorical.html">Categorical data</a>
              </li>
          
        
          
              <li class="">
                  <a href="integer_na.html">Nullable integer data type</a>
              </li>
          
        
          
              <li class="">
                  <a href="boolean.html">Nullable Boolean Data Type</a>
              </li>
          
        
          
              <li class="">
                  <a href="visualization.html">Visualization</a>
              </li>
          
        
          
              <li class="active">
                  <a href="">Computational tools</a>
              </li>
          
        
          
              <li class="">
                  <a href="groupby.html">Group By: split-apply-combine</a>
              </li>
          
        
          
              <li class="">
                  <a href="timeseries.html">Time series / date functionality</a>
              </li>
          
        
          
              <li class="">
                  <a href="timedeltas.html">Time deltas</a>
              </li>
          
        
          
              <li class="">
                  <a href="style.html">Styling</a>
              </li>
          
        
          
              <li class="">
                  <a href="options.html">Options and settings</a>
              </li>
          
        
          
              <li class="">
                  <a href="enhancingperf.html">Enhancing performance</a>
              </li>
          
        
          
              <li class="">
                  <a href="scale.html">Scaling to large datasets</a>
              </li>
          
        
          
              <li class="">
                  <a href="sparse.html">Sparse data structures</a>
              </li>
          
        
          
              <li class="">
                  <a href="gotchas.html">Frequently Asked Questions (FAQ)</a>
              </li>
          
        
          
              <li class="">
                  <a href="cookbook.html">Cookbook</a>
              </li>
          
        
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>

          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage"><i class="fas fa-list"></i> On this page</div>
<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#statistical-functions" class="nav-link">Statistical functions</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#percent-change" class="nav-link">Percent change</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#covariance" class="nav-link">Covariance</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#correlation" class="nav-link">Correlation</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#data-ranking" class="nav-link">Data ranking</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#window-functions" class="nav-link">Window Functions</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#method-summary" class="nav-link">Method summary</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#rolling-apply" class="nav-link">Rolling Apply</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#rolling-windows" class="nav-link">Rolling windows</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#time-aware-rolling" class="nav-link">Time-aware rolling</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#custom-window-rolling" class="nav-link">Custom window rolling</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#rolling-window-endpoints" class="nav-link">Rolling window endpoints</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#time-aware-rolling-vs-resampling" class="nav-link">Time-aware rolling vs. resampling</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#centering-windows" class="nav-link">Centering windows</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#binary-window-functions" class="nav-link">Binary window functions</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#computing-rolling-pairwise-covariances-and-correlations" class="nav-link">Computing rolling pairwise covariances and correlations</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#aggregation" class="nav-link">Aggregation</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#applying-multiple-functions" class="nav-link">Applying multiple functions</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#applying-different-functions-to-dataframe-columns" class="nav-link">Applying different functions to DataFrame columns</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#expanding-windows" class="nav-link">Expanding windows</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#id1" class="nav-link">Method summary</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#exponentially-weighted-windows" class="nav-link">Exponentially weighted windows</a>
        </li>
    
    </ul>
</nav>
              
            </div>

          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
              <div>
                
  <div class="section" id="computational-tools">
<span id="computation"></span><h1>Computational tools<a class="headerlink" href="#computational-tools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="statistical-functions">
<h2>Statistical functions<a class="headerlink" href="#statistical-functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="percent-change">
<span id="computation-pct-change"></span><h3>Percent change<a class="headerlink" href="#percent-change" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> have a method
<code class="xref py py-meth docutils literal notranslate"><span class="pre">pct_change()</span></code> to compute the percent change over a given number
of periods (using <code class="docutils literal notranslate"><span class="pre">fill_method</span></code> to fill NA/null values <em>before</em> computing
the percent change).</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>

<span class="gp">In [2]: </span><span class="n">ser</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
<span class="gh">Out[2]: </span><span class="go"></span>
<span class="go">0         NaN</span>
<span class="go">1   -1.602976</span>
<span class="go">2    4.334938</span>
<span class="go">3   -0.247456</span>
<span class="go">4   -2.067345</span>
<span class="go">5   -1.142903</span>
<span class="go">6   -1.688214</span>
<span class="go">7   -9.759729</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="gp">In [4]: </span><span class="n">df</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gh">Out[4]: </span><span class="go"></span>
<span class="go">          0         1         2         3</span>
<span class="go">0       NaN       NaN       NaN       NaN</span>
<span class="go">1       NaN       NaN       NaN       NaN</span>
<span class="go">2       NaN       NaN       NaN       NaN</span>
<span class="go">3 -0.218320 -1.054001  1.987147 -0.510183</span>
<span class="go">4 -0.439121 -1.816454  0.649715 -4.822809</span>
<span class="go">5 -0.127833 -3.042065 -5.866604 -1.776977</span>
<span class="go">6 -2.596833 -1.959538 -2.111697 -3.798900</span>
<span class="go">7 -0.117826 -2.169058  0.036094 -0.067696</span>
<span class="go">8  2.492606 -1.357320 -1.205802 -1.558697</span>
<span class="go">9 -1.012977  2.324558 -1.003744 -0.371806</span>
</pre></div>
</div>
</div>
<div class="section" id="covariance">
<span id="computation-covariance"></span><h3>Covariance<a class="headerlink" href="#covariance" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.cov()</span></code> can be used to compute covariance between series
(excluding missing values).</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>

<span class="gp">In [6]: </span><span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>

<span class="gp">In [7]: </span><span class="n">s1</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
<span class="gh">Out[7]: </span><span class="go">0.0006801088174310875</span>
</pre></div>
</div>
<p>Analogously, <code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.cov()</span></code> to compute pairwise covariances among the
series in the DataFrame, also excluding NA/null values.</p>
<div class="alert alert-info" id="computation-covariance-caveats">
<p class="admonition-title">Note</p>
<p>Assuming the missing data are missing at random this results in an estimate
for the covariance matrix which is unbiased. However, for many applications
this estimate may not be acceptable because the estimated covariance matrix
is not guaranteed to be positive semi-definite. This could lead to
estimated correlations having absolute values which are greater than one,
and/or a non-invertible covariance matrix. See <a class="reference external" href="http://en.wikipedia.org/w/index.php?title=Estimation_of_covariance_matrices">Estimation of covariance
matrices</a>
for more details.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="gp">   ...: </span>                     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
<span class="gp">   ...: </span>

<span class="gp">In [9]: </span><span class="n">frame</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="gh">Out[9]: </span><span class="go"></span>
<span class="go">          a         b         c         d         e</span>
<span class="go">a  1.000882 -0.003177 -0.002698 -0.006889  0.031912</span>
<span class="go">b -0.003177  1.024721  0.000191  0.009212  0.000857</span>
<span class="go">c -0.002698  0.000191  0.950735 -0.031743 -0.005087</span>
<span class="go">d -0.006889  0.009212 -0.031743  1.002983 -0.047952</span>
<span class="go">e  0.031912  0.000857 -0.005087 -0.047952  1.042487</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame.cov</span></code> also supports an optional <code class="docutils literal notranslate"><span class="pre">min_periods</span></code> keyword that
specifies the required minimum number of observations for each column pair
in order to have a valid result.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>

<span class="gp">In [11]: </span><span class="n">frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [12]: </span><span class="n">frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [13]: </span><span class="n">frame</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="gh">Out[13]: </span><span class="go"></span>
<span class="go">          a         b         c</span>
<span class="go">a  1.123670 -0.412851  0.018169</span>
<span class="go">b -0.412851  1.154141  0.305260</span>
<span class="go">c  0.018169  0.305260  1.301149</span>

<span class="gp">In [14]: </span><span class="n">frame</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="gh">Out[14]: </span><span class="go"></span>
<span class="go">          a         b         c</span>
<span class="go">a  1.123670       NaN  0.018169</span>
<span class="go">b       NaN  1.154141  0.305260</span>
<span class="go">c  0.018169  0.305260  1.301149</span>
</pre></div>
</div>
</div>
<div class="section" id="correlation">
<span id="computation-correlation"></span><h3>Correlation<a class="headerlink" href="#correlation" title="Permalink to this headline">¶</a></h3>
<p>Correlation may be computed using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">corr()</span></code> method.
Using the <code class="docutils literal notranslate"><span class="pre">method</span></code> parameter, several methods for computing correlations are
provided:</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pearson</span> <span class="pre">(default)</span></code></p></td>
<td><p>Standard correlation coefficient</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kendall</span></code></p></td>
<td><p>Kendall Tau correlation coefficient</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spearman</span></code></p></td>
<td><p>Spearman rank correlation coefficient</p></td>
</tr>
</tbody>
</table>
<p>All of these are currently computed using pairwise complete observations.
Wikipedia has articles covering the above correlation coefficients:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Pearson_correlation_coefficient">Pearson correlation coefficient</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient">Kendall rank correlation coefficient</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient">Spearman’s rank correlation coefficient</a></p></li>
</ul>
<div class="alert alert-info">
<p class="admonition-title">Note</p>
<p>Please see the <a class="reference internal" href="#computation-covariance-caveats"><span class="std std-ref">caveats</span></a> associated
with this method of calculating correlation matrices in the
<a class="reference internal" href="#computation-covariance"><span class="std std-ref">covariance section</span></a>.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="gp">   ....: </span>                     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
<span class="gp">   ....: </span>

<span class="gp">In [16]: </span><span class="n">frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="go"># Series with Series</span>
<span class="gp">In [17]: </span><span class="n">frame</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
<span class="gh">Out[17]: </span><span class="go">0.013479040400098775</span>

<span class="gp">In [18]: </span><span class="n">frame</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">18</span><span class="o">-</span><span class="mi">3</span><span class="n">a09724e6474</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">frame</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>

<span class="nn">~/scipy/pandas/pandas/core/series.py</span> in <span class="ni">corr</span><span class="nt">(self, other, method, min_periods)</span>
<span class="g g-Whitespace">   </span><span class="mi">2179</span>         <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;spearman&quot;</span><span class="p">,</span> <span class="s2">&quot;kendall&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">callable</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2180</span>             <span class="k">return</span> <span class="n">nanops</span><span class="o">.</span><span class="n">nancorr</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">2181</span>                 <span class="n">this</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">min_periods</span>
<span class="g g-Whitespace">   </span><span class="mi">2182</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2183</span> 

<span class="nn">~/scipy/pandas/pandas/core/nanops.py</span> in <span class="ni">_f</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>             <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span>                 <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">69</span>                     <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>             <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span>                 <span class="c1"># we want to transform an object array</span>

<span class="nn">~/scipy/pandas/pandas/core/nanops.py</span> in <span class="ni">nancorr</span><span class="nt">(a, b, method, min_periods)</span>
<span class="g g-Whitespace">   </span><span class="mi">1237</span>         <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="g g-Whitespace">   </span><span class="mi">1238</span> 
<span class="ne">-&gt; </span><span class="mi">1239</span>     <span class="n">f</span> <span class="o">=</span> <span class="n">get_corr_func</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1240</span>     <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1241</span> 

<span class="nn">~/scipy/pandas/pandas/core/nanops.py</span> in <span class="ni">get_corr_func</span><span class="nt">(method)</span>
<span class="g g-Whitespace">   </span><span class="mi">1243</span> <span class="k">def</span> <span class="nf">get_corr_func</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1244</span>     <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kendall&quot;</span><span class="p">,</span> <span class="s2">&quot;spearman&quot;</span><span class="p">]:</span>
<span class="ne">-&gt; </span><span class="mi">1245</span>         <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">kendalltau</span><span class="p">,</span> <span class="n">spearmanr</span>
<span class="g g-Whitespace">   </span><span class="mi">1246</span>     <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pearson&quot;</span><span class="p">]:</span>
<span class="g g-Whitespace">   </span><span class="mi">1247</span>         <span class="k">pass</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;scipy&#39;

<span class="c1"># Pairwise correlation of DataFrame columns</span>
<span class="gp">In [19]: </span><span class="n">frame</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="gh">Out[19]: </span><span class="go"></span>
<span class="go">          a         b         c         d         e</span>
<span class="go">a  1.000000  0.013479 -0.049269 -0.042239 -0.028525</span>
<span class="go">b  0.013479  1.000000 -0.020433 -0.011139  0.005654</span>
<span class="go">c -0.049269 -0.020433  1.000000  0.018587 -0.054269</span>
<span class="go">d -0.042239 -0.011139  0.018587  1.000000 -0.017060</span>
<span class="go">e -0.028525  0.005654 -0.054269 -0.017060  1.000000</span>
</pre></div>
</div>
<p>Note that non-numeric columns will be automatically excluded from the
correlation calculation.</p>
<p>Like <code class="docutils literal notranslate"><span class="pre">cov</span></code>, <code class="docutils literal notranslate"><span class="pre">corr</span></code> also supports the optional <code class="docutils literal notranslate"><span class="pre">min_periods</span></code> keyword:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [20]: </span><span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>

<span class="gp">In [21]: </span><span class="n">frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [22]: </span><span class="n">frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [23]: </span><span class="n">frame</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="gh">Out[23]: </span><span class="go"></span>
<span class="go">          a         b         c</span>
<span class="go">a  1.000000 -0.121111  0.069544</span>
<span class="go">b -0.121111  1.000000  0.051742</span>
<span class="go">c  0.069544  0.051742  1.000000</span>

<span class="gp">In [24]: </span><span class="n">frame</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="gh">Out[24]: </span><span class="go"></span>
<span class="go">          a         b         c</span>
<span class="go">a  1.000000       NaN  0.069544</span>
<span class="go">b       NaN  1.000000  0.051742</span>
<span class="go">c  0.069544  0.051742  1.000000</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.24.0.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">method</span></code> argument can also be a callable for a generic correlation
calculation. In this case, it should be a single function
that produces a single value from two ndarray inputs. Suppose we wanted to
compute the correlation based on histogram intersection:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># histogram intersection</span>
<span class="gp">In [25]: </span><span class="k">def</span> <span class="nf">histogram_intersection</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">true_divide</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span>
<span class="gp">   ....: </span>                      <span class="n">np</span><span class="o">.</span><span class="n">true_divide</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gp">   ....: </span>

<span class="gp">In [26]: </span><span class="n">frame</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">histogram_intersection</span><span class="p">)</span>
<span class="gh">Out[26]: </span><span class="go"></span>
<span class="go">          a          b          c</span>
<span class="go">a  1.000000  -6.404882  -2.058431</span>
<span class="go">b -6.404882   1.000000 -19.255743</span>
<span class="go">c -2.058431 -19.255743   1.000000</span>
</pre></div>
</div>
<p>A related method <code class="xref py py-meth docutils literal notranslate"><span class="pre">corrwith()</span></code> is implemented on DataFrame to
compute the correlation between like-labeled Series contained in different
DataFrame objects.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [27]: </span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]</span>

<span class="gp">In [28]: </span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">]</span>

<span class="gp">In [29]: </span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

<span class="gp">In [30]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

<span class="gp">In [31]: </span><span class="n">df1</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="gh">Out[31]: </span><span class="go"></span>
<span class="go">one     -0.125501</span>
<span class="go">two     -0.493244</span>
<span class="go">three    0.344056</span>
<span class="go">four     0.004183</span>
<span class="go">dtype: float64</span>

<span class="gp">In [32]: </span><span class="n">df2</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[32]: </span><span class="go"></span>
<span class="go">a   -0.675817</span>
<span class="go">b    0.458296</span>
<span class="go">c    0.190809</span>
<span class="go">d   -0.186275</span>
<span class="go">e         NaN</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
</div>
<div class="section" id="data-ranking">
<span id="computation-ranking"></span><h3>Data ranking<a class="headerlink" href="#data-ranking" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">rank()</span></code> method produces a data ranking with ties being
assigned the mean of the ranks (by default) for the group:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcde&#39;</span><span class="p">))</span>

<span class="gp">In [34]: </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>  <span class="c1"># so there&#39;s a tie</span>

<span class="gp">In [35]: </span><span class="n">s</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span>
<span class="gh">Out[35]: </span><span class="go"></span>
<span class="go">a    5.0</span>
<span class="go">b    2.5</span>
<span class="go">c    1.0</span>
<span class="go">d    2.5</span>
<span class="go">e    4.0</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">rank()</span></code> is also a DataFrame method and can rank either the rows
(<code class="docutils literal notranslate"><span class="pre">axis=0</span></code>) or the columns (<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>). <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values are excluded from the
ranking.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [36]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="gp">In [37]: </span><span class="n">df</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># some ties</span>

<span class="gp">In [38]: </span><span class="n">df</span>
<span class="gh">Out[38]: </span><span class="go"></span>
<span class="go">          0         1         2         3         4         5</span>
<span class="go">0 -0.904948 -1.163537 -1.457187  0.135463 -1.457187  0.294650</span>
<span class="go">1 -0.976288 -0.244652 -0.748406 -0.999601 -0.748406 -0.800809</span>
<span class="go">2  0.401965  1.460840  1.256057  1.308127  1.256057  0.876004</span>
<span class="go">3  0.205954  0.369552 -0.669304  0.038378 -0.669304  1.140296</span>
<span class="go">4 -0.477586 -0.730705 -1.129149 -0.601463 -1.129149 -0.211196</span>
<span class="go">5 -1.092970 -0.689246  0.908114  0.204848       NaN  0.463347</span>
<span class="go">6  0.376892  0.959292  0.095572 -0.593740       NaN -0.069180</span>
<span class="go">7 -1.002601  1.957794 -0.120708  0.094214       NaN -1.467422</span>
<span class="go">8 -0.547231  0.664402 -0.519424 -0.073254       NaN -1.263544</span>
<span class="go">9 -0.250277 -0.237428 -1.056443  0.419477       NaN  1.375064</span>

<span class="gp">In [39]: </span><span class="n">df</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[39]: </span><span class="go"></span>
<span class="go">     0    1    2    3    4    5</span>
<span class="go">0  4.0  3.0  1.5  5.0  1.5  6.0</span>
<span class="go">1  2.0  6.0  4.5  1.0  4.5  3.0</span>
<span class="go">2  1.0  6.0  3.5  5.0  3.5  2.0</span>
<span class="go">3  4.0  5.0  1.5  3.0  1.5  6.0</span>
<span class="go">4  5.0  3.0  1.5  4.0  1.5  6.0</span>
<span class="go">5  1.0  2.0  5.0  3.0  NaN  4.0</span>
<span class="go">6  4.0  5.0  3.0  1.0  NaN  2.0</span>
<span class="go">7  2.0  5.0  3.0  4.0  NaN  1.0</span>
<span class="go">8  2.0  5.0  3.0  4.0  NaN  1.0</span>
<span class="go">9  2.0  3.0  1.0  4.0  NaN  5.0</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">rank</span></code> optionally takes a parameter <code class="docutils literal notranslate"><span class="pre">ascending</span></code> which by default is true;
when false, data is reverse-ranked, with larger values assigned a smaller rank.</p>
<p><code class="docutils literal notranslate"><span class="pre">rank</span></code> supports different tie-breaking methods, specified with the <code class="docutils literal notranslate"><span class="pre">method</span></code>
parameter:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">average</span></code> : average rank of tied group</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min</span></code> : lowest rank in the group</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max</span></code> : highest rank in the group</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">first</span></code> : ranks assigned in the order they appear in the array</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="window-functions">
<span id="stats-moments"></span><h2>Window Functions<a class="headerlink" href="#window-functions" title="Permalink to this headline">¶</a></h2>
<p>For working with data, a number of window functions are provided for
computing common <em>window</em> or <em>rolling</em> statistics. Among these are count, sum,
mean, median, correlation, variance, covariance, standard deviation, skewness,
and kurtosis.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">rolling()</span></code> and <code class="docutils literal notranslate"><span class="pre">expanding()</span></code>
functions can be used directly from DataFrameGroupBy objects,
see the <a class="reference internal" href="groupby.html#groupby-transform-window-resample"><span class="std std-ref">groupby docs</span></a>.</p>
<div class="alert alert-info">
<p class="admonition-title">Note</p>
<p>The API for window statistics is quite similar to the way one works with <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> objects, see the documentation <a class="reference internal" href="groupby.html#groupby"><span class="std std-ref">here</span></a>.</p>
</div>
<p>We work with <code class="docutils literal notranslate"><span class="pre">rolling</span></code>, <code class="docutils literal notranslate"><span class="pre">expanding</span></code> and <code class="docutils literal notranslate"><span class="pre">exponentially</span> <span class="pre">weighted</span></code> data through the corresponding
objects, <code class="xref py py-class docutils literal notranslate"><span class="pre">Rolling</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Expanding</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">EWM</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [40]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
<span class="gp">   ....: </span>              <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
<span class="gp">   ....: </span>

<span class="gp">In [41]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

<span class="gp">In [42]: </span><span class="n">s</span>
<span class="gh">Out[42]: </span><span class="go"></span>
<span class="go">2000-01-01    -0.268824</span>
<span class="go">2000-01-02    -1.771855</span>
<span class="go">2000-01-03    -0.818003</span>
<span class="go">2000-01-04    -0.659244</span>
<span class="go">2000-01-05    -1.942133</span>
<span class="go">                ...    </span>
<span class="go">2002-09-22   -67.457323</span>
<span class="go">2002-09-23   -69.253182</span>
<span class="go">2002-09-24   -70.296818</span>
<span class="go">2002-09-25   -70.844674</span>
<span class="go">2002-09-26   -72.475016</span>
<span class="go">Freq: D, Length: 1000, dtype: float64</span>
</pre></div>
</div>
<p>These are created from methods on <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [43]: </span><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="gp">In [44]: </span><span class="n">r</span>
<span class="gh">Out[44]: </span><span class="go">Rolling [window=60,center=False,axis=0]</span>
</pre></div>
</div>
<p>These object provide tab-completion of the available methods and properties.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">r</span><span class="o">.&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>                                          <span class="c1"># noqa: E225, E999</span>
<span class="go">r.agg         r.apply       r.count       r.exclusions  r.max         r.median      r.name        r.skew        r.sum</span>
<span class="go">r.aggregate   r.corr        r.cov         r.kurt        r.mean        r.min         r.quantile    r.std         r.var</span>
</pre></div>
</div>
<p>Generally these methods all have the same interface. They all
accept the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">window</span></code>: size of moving window</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_periods</span></code>: threshold of non-null data points to require (otherwise
result is NA)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">center</span></code>: boolean, whether to set the labels at the center (default is False)</p></li>
</ul>
<p>We can then call methods on these <code class="docutils literal notranslate"><span class="pre">rolling</span></code> objects. These return like-indexed objects:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [45]: </span><span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[45]: </span><span class="go"></span>
<span class="go">2000-01-01          NaN</span>
<span class="go">2000-01-02          NaN</span>
<span class="go">2000-01-03          NaN</span>
<span class="go">2000-01-04          NaN</span>
<span class="go">2000-01-05          NaN</span>
<span class="go">                ...    </span>
<span class="go">2002-09-22   -62.914971</span>
<span class="go">2002-09-23   -63.061867</span>
<span class="go">2002-09-24   -63.213876</span>
<span class="go">2002-09-25   -63.375074</span>
<span class="go">2002-09-26   -63.539734</span>
<span class="go">Freq: D, Length: 1000, dtype: float64</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [46]: </span><span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="gh">Out[46]: </span><span class="go">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f65bd288828&gt;</span>

<span class="gp">In [47]: </span><span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="gh">Out[47]: </span><span class="go">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f65bd288828&gt;</span>
</pre></div>
</div>
<img alt="../_images/rolling_mean_ex.png" src="../_images/rolling_mean_ex.png" />
<p>They can also be applied to DataFrame objects. This is really just syntactic
sugar for applying the moving window operator to all of the DataFrame’s columns:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [48]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">   ....: </span>                  <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
<span class="gp">   ....: </span>                  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">])</span>
<span class="gp">   ....: </span>

<span class="gp">In [49]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

<span class="gp">In [50]: </span><span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gh">Out[50]: </span><span class="go"></span>
<span class="go">array([&lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f6589eae4e0&gt;,</span>
<span class="go">       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f6589e69a58&gt;,</span>
<span class="go">       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f6589e19a20&gt;,</span>
<span class="go">       &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f6589dcb9e8&gt;],</span>
<span class="go">      dtype=object)</span>
</pre></div>
</div>
<img alt="../_images/rolling_mean_frame.png" src="../_images/rolling_mean_frame.png" />
<div class="section" id="method-summary">
<span id="stats-summary"></span><h3>Method summary<a class="headerlink" href="#method-summary" title="Permalink to this headline">¶</a></h3>
<p>We provide a number of common statistical functions:</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">count()</span></code></p></td>
<td><p>Number of non-null observations</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">sum()</span></code></p></td>
<td><p>Sum of values</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">mean()</span></code></p></td>
<td><p>Mean of values</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">median()</span></code></p></td>
<td><p>Arithmetic median of values</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">min()</span></code></p></td>
<td><p>Minimum</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">max()</span></code></p></td>
<td><p>Maximum</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">std()</span></code></p></td>
<td><p>Bessel-corrected sample standard deviation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">var()</span></code></p></td>
<td><p>Unbiased variance</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">skew()</span></code></p></td>
<td><p>Sample skewness (3rd moment)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">kurt()</span></code></p></td>
<td><p>Sample kurtosis (4th moment)</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">quantile()</span></code></p></td>
<td><p>Sample quantile (value at %)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></p></td>
<td><p>Generic apply</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">cov()</span></code></p></td>
<td><p>Unbiased covariance (binary)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">corr()</span></code></p></td>
<td><p>Correlation (binary)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="rolling-apply">
<span id="stats-rolling-apply"></span><h3>Rolling Apply<a class="headerlink" href="#rolling-apply" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code> function takes an extra <code class="docutils literal notranslate"><span class="pre">func</span></code> argument and performs
generic rolling computations. The <code class="docutils literal notranslate"><span class="pre">func</span></code> argument should be a single function
that produces a single value from an ndarray input. Suppose we wanted to
compute the mean absolute deviation on a rolling basis:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [51]: </span><span class="k">def</span> <span class="nf">mad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gp">   ....: </span>

<span class="gp">In [52]: </span><span class="n">s</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mad</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="gh">Out[52]: </span><span class="go">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f6589c61048&gt;</span>
</pre></div>
</div>
<img alt="../_images/rolling_apply_ex.png" src="../_images/rolling_apply_ex.png" />
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.0.</span></p>
</div>
<p>Additionally, <code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code> can leverage <a class="reference external" href="https://numba.pydata.org/">Numba</a>
if installed as an optional dependency. The apply aggregation can be executed using Numba by specifying
<code class="docutils literal notranslate"><span class="pre">engine='numba'</span></code> and <code class="docutils literal notranslate"><span class="pre">engine_kwargs</span></code> arguments (<code class="docutils literal notranslate"><span class="pre">raw</span></code> must also be set to <code class="docutils literal notranslate"><span class="pre">True</span></code>).
Numba will be applied in potentially two routines:</p>
<p>1. If <code class="docutils literal notranslate"><span class="pre">func</span></code> is a standard Python function, the engine will <a class="reference external" href="http://numba.pydata.org/numba-doc/latest/user/overview.html">JIT</a>
the passed function. <code class="docutils literal notranslate"><span class="pre">func</span></code> can also be a JITed function in which case the engine will not JIT the function again.</p>
<ol class="arabic simple" start="2">
<li><p>The engine will JIT the for loop where the apply function is applied to each window.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">engine_kwargs</span></code> argument is a dictionary of keyword arguments that will be passed into the
<a class="reference external" href="https://numba.pydata.org/numba-doc/latest/reference/jit-compilation.html#numba.jit">numba.jit decorator</a>.
These keyword arguments will be applied to <em>both</em> the passed function (if a standard Python function)
and the apply for loop over each window. Currently only <code class="docutils literal notranslate"><span class="pre">nogil</span></code>, <code class="docutils literal notranslate"><span class="pre">nopython</span></code>, and <code class="docutils literal notranslate"><span class="pre">parallel</span></code> are supported,
and their default values are set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, <code class="docutils literal notranslate"><span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> respectively.</p>
<div class="alert alert-info">
<p class="admonition-title">Note</p>
<p>In terms of performance, <strong>the first time a function is run using the Numba engine will be slow</strong>
as Numba will have some function compilation overhead. However, <code class="docutils literal notranslate"><span class="pre">rolling</span></code> objects will cache
the function and subsequent calls will be fast. In general, the Numba engine is performant with
a larger amount of data points (e.g. 1+ million).</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="n">_000_000</span><span class="p">))</span>

<span class="gp">In [2]: </span><span class="n">roll</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>
<span class="go"># Run the first time, compilation time will affect performance</span>
<span class="gp">In [4]: </span><span class="o">%</span><span class="k">timeit</span> -r 1 -n 1 roll.apply(f, engine=&#39;numba&#39;, raw=True)  # noqa: E225
<span class="go">1.23 s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</span>
<span class="go"># Function is cached and performance will improve</span>
<span class="gp">In [5]: </span><span class="o">%</span><span class="k">timeit</span> roll.apply(f, engine=&#39;numba&#39;, raw=True)
<span class="go">188 ms ± 1.93 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>

<span class="gp">In [6]: </span><span class="o">%</span><span class="k">timeit</span> roll.apply(f, engine=&#39;cython&#39;, raw=True)
<span class="go">3.92 s ± 59 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>
</pre></div>
</div>
</div>
<div class="section" id="rolling-windows">
<span id="stats-rolling-window"></span><h3>Rolling windows<a class="headerlink" href="#rolling-windows" title="Permalink to this headline">¶</a></h3>
<p>Passing <code class="docutils literal notranslate"><span class="pre">win_type</span></code> to <code class="docutils literal notranslate"><span class="pre">.rolling</span></code> generates a generic rolling window computation, that is weighted according the <code class="docutils literal notranslate"><span class="pre">win_type</span></code>.
The following methods are available:</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">sum()</span></code></p></td>
<td><p>Sum of values</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">mean()</span></code></p></td>
<td><p>Mean of values</p></td>
</tr>
</tbody>
</table>
<p>The weights used in the window are specified by the <code class="docutils literal notranslate"><span class="pre">win_type</span></code> keyword.
The list of recognized types are the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/signal.html#window-functions">scipy.signal window functions</a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">boxcar</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">triang</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blackman</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hamming</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bartlett</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parzen</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bohman</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blackmanharris</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nuttall</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">barthann</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kaiser</span></code> (needs beta)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gaussian</span></code> (needs std)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">general_gaussian</span></code> (needs power, width)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">slepian</span></code> (needs width)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exponential</span></code> (needs tau).</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [53]: </span><span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="gp">   ....: </span>                <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="gp">   ....: </span>

<span class="gp">In [54]: </span><span class="n">ser</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">win_type</span><span class="o">=</span><span class="s1">&#39;triang&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">54</span><span class="o">-</span><span class="n">a42237a4feee</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ser</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">win_type</span><span class="o">=</span><span class="s1">&#39;triang&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nn">~/scipy/pandas/pandas/core/generic.py</span> in <span class="ni">rolling</span><span class="nt">(self, window, min_periods, center, win_type, on, axis, closed)</span>
<span class="g g-Whitespace">  </span><span class="mi">10102</span>                     <span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span>
<span class="g g-Whitespace">  </span><span class="mi">10103</span>                     <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
<span class="ne">&gt; </span><span class="mi">10104</span>                     <span class="n">closed</span><span class="o">=</span><span class="n">closed</span><span class="p">,</span>
<span class="g g-Whitespace">  </span><span class="mi">10105</span>                 <span class="p">)</span>
<span class="g g-Whitespace">  </span><span class="mi">10106</span> 

<span class="nn">~/scipy/pandas/pandas/core/window/rolling.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, window, min_periods, center, win_type, axis, on, closed, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span>         <span class="bp">self</span><span class="o">.</span><span class="n">win_freq</span> <span class="o">=</span> <span class="bp">None</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>         <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_get_axis_number</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">None</span>
<span class="ne">---&gt; </span><span class="mi">94</span>         <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">95</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_numba_func_cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span> 

<span class="nn">~/scipy/pandas/pandas/core/window/rolling.py</span> in <span class="ni">validate</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">949</span>                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;window must be &gt; 0 &quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">950</span>             <span class="n">import_optional_dependency</span><span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">951</span>                 <span class="s2">&quot;scipy&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;Scipy is required to generate window weight.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">952</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">953</span>             <span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="kn">as</span> <span class="nn">sig</span>

<span class="nn">~/scipy/pandas/pandas/compat/_optional.py</span> in <span class="ni">import_optional_dependency</span><span class="nt">(name, extra, raise_on_missing, on_version)</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span>     <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span>         <span class="k">if</span> <span class="n">raise_on_missing</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">91</span>             <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>             <span class="k">return</span> <span class="bp">None</span>

<span class="ne">ImportError</span>: Missing optional dependency &#39;scipy&#39;. Scipy is required to generate window weight. Use pip or conda to install scipy.
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">boxcar</span></code> window is equivalent to <code class="xref py py-meth docutils literal notranslate"><span class="pre">mean()</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [55]: </span><span class="n">ser</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">win_type</span><span class="o">=</span><span class="s1">&#39;boxcar&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">55</span><span class="o">-</span><span class="n">d77bdc3f0969</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ser</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">win_type</span><span class="o">=</span><span class="s1">&#39;boxcar&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nn">~/scipy/pandas/pandas/core/generic.py</span> in <span class="ni">rolling</span><span class="nt">(self, window, min_periods, center, win_type, on, axis, closed)</span>
<span class="g g-Whitespace">  </span><span class="mi">10102</span>                     <span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span>
<span class="g g-Whitespace">  </span><span class="mi">10103</span>                     <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
<span class="ne">&gt; </span><span class="mi">10104</span>                     <span class="n">closed</span><span class="o">=</span><span class="n">closed</span><span class="p">,</span>
<span class="g g-Whitespace">  </span><span class="mi">10105</span>                 <span class="p">)</span>
<span class="g g-Whitespace">  </span><span class="mi">10106</span> 

<span class="nn">~/scipy/pandas/pandas/core/window/rolling.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, window, min_periods, center, win_type, axis, on, closed, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span>         <span class="bp">self</span><span class="o">.</span><span class="n">win_freq</span> <span class="o">=</span> <span class="bp">None</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>         <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_get_axis_number</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">None</span>
<span class="ne">---&gt; </span><span class="mi">94</span>         <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">95</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_numba_func_cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span> 

<span class="nn">~/scipy/pandas/pandas/core/window/rolling.py</span> in <span class="ni">validate</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">949</span>                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;window must be &gt; 0 &quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">950</span>             <span class="n">import_optional_dependency</span><span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">951</span>                 <span class="s2">&quot;scipy&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;Scipy is required to generate window weight.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">952</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">953</span>             <span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="kn">as</span> <span class="nn">sig</span>

<span class="nn">~/scipy/pandas/pandas/compat/_optional.py</span> in <span class="ni">import_optional_dependency</span><span class="nt">(name, extra, raise_on_missing, on_version)</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span>     <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span>         <span class="k">if</span> <span class="n">raise_on_missing</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">91</span>             <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>             <span class="k">return</span> <span class="bp">None</span>

<span class="ne">ImportError</span>: Missing optional dependency &#39;scipy&#39;. Scipy is required to generate window weight. Use pip or conda to install scipy.

<span class="gp">In [56]: </span><span class="n">ser</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[56]: </span><span class="go"></span>
<span class="go">2000-01-01         NaN</span>
<span class="go">2000-01-02         NaN</span>
<span class="go">2000-01-03         NaN</span>
<span class="go">2000-01-04         NaN</span>
<span class="go">2000-01-05   -0.841164</span>
<span class="go">2000-01-06   -0.779948</span>
<span class="go">2000-01-07   -0.565487</span>
<span class="go">2000-01-08   -0.502815</span>
<span class="go">2000-01-09   -0.553755</span>
<span class="go">2000-01-10   -0.472211</span>
<span class="go">Freq: D, dtype: float64</span>
</pre></div>
</div>
<p>For some windowing functions, additional parameters must be specified:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [57]: </span><span class="n">ser</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">win_type</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">std</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">57</span><span class="o">-</span><span class="n">dbbb08454bfa</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ser</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">win_type</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">std</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="nn">~/scipy/pandas/pandas/core/generic.py</span> in <span class="ni">rolling</span><span class="nt">(self, window, min_periods, center, win_type, on, axis, closed)</span>
<span class="g g-Whitespace">  </span><span class="mi">10102</span>                     <span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span>
<span class="g g-Whitespace">  </span><span class="mi">10103</span>                     <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
<span class="ne">&gt; </span><span class="mi">10104</span>                     <span class="n">closed</span><span class="o">=</span><span class="n">closed</span><span class="p">,</span>
<span class="g g-Whitespace">  </span><span class="mi">10105</span>                 <span class="p">)</span>
<span class="g g-Whitespace">  </span><span class="mi">10106</span> 

<span class="nn">~/scipy/pandas/pandas/core/window/rolling.py</span> in <span class="ni">__init__</span><span class="nt">(self, obj, window, min_periods, center, win_type, axis, on, closed, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span>         <span class="bp">self</span><span class="o">.</span><span class="n">win_freq</span> <span class="o">=</span> <span class="bp">None</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>         <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_get_axis_number</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">None</span>
<span class="ne">---&gt; </span><span class="mi">94</span>         <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">95</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_numba_func_cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span> 

<span class="nn">~/scipy/pandas/pandas/core/window/rolling.py</span> in <span class="ni">validate</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">949</span>                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;window must be &gt; 0 &quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">950</span>             <span class="n">import_optional_dependency</span><span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">951</span>                 <span class="s2">&quot;scipy&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;Scipy is required to generate window weight.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">952</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">953</span>             <span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="kn">as</span> <span class="nn">sig</span>

<span class="nn">~/scipy/pandas/pandas/compat/_optional.py</span> in <span class="ni">import_optional_dependency</span><span class="nt">(name, extra, raise_on_missing, on_version)</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span>     <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span>         <span class="k">if</span> <span class="n">raise_on_missing</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">91</span>             <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>             <span class="k">return</span> <span class="bp">None</span>

<span class="ne">ImportError</span>: Missing optional dependency &#39;scipy&#39;. Scipy is required to generate window weight. Use pip or conda to install scipy.
</pre></div>
</div>
<div class="alert alert-info" id="stats-moments-normalization">
<p class="admonition-title">Note</p>
<p>For <code class="docutils literal notranslate"><span class="pre">.sum()</span></code> with a <code class="docutils literal notranslate"><span class="pre">win_type</span></code>, there is no normalization done to the
weights for the window. Passing custom weights of <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">1,</span> <span class="pre">1]</span></code> will yield a different
result than passing weights of <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">2,</span> <span class="pre">2]</span></code>, for example. When passing a
<code class="docutils literal notranslate"><span class="pre">win_type</span></code> instead of explicitly specifying the weights, the weights are
already normalized so that the largest weight is 1.</p>
<p>In contrast, the nature of the <code class="docutils literal notranslate"><span class="pre">.mean()</span></code> calculation is
such that the weights are normalized with respect to each other. Weights
of <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">1,</span> <span class="pre">1]</span></code> and <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">2,</span> <span class="pre">2]</span></code> yield the same result.</p>
</div>
</div>
<div class="section" id="time-aware-rolling">
<span id="stats-moments-ts"></span><h3>Time-aware rolling<a class="headerlink" href="#time-aware-rolling" title="Permalink to this headline">¶</a></h3>
<p>It is possible to pass an offset (or convertible) to a <code class="docutils literal notranslate"><span class="pre">.rolling()</span></code> method and have it produce
variable sized windows based on the passed time window. For each time point, this includes all preceding values occurring
within the indicated time delta.</p>
<p>This can be particularly useful for a non-regular time frequency index.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [58]: </span><span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">]},</span>
<span class="gp">   ....: </span>                   <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:00&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span>                                       <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="gp">   ....: </span>                                       <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">))</span>
<span class="gp">   ....: </span>

<span class="gp">In [59]: </span><span class="n">dft</span>
<span class="gh">Out[59]: </span><span class="go"></span>
<span class="go">                       B</span>
<span class="go">2013-01-01 09:00:00  0.0</span>
<span class="go">2013-01-01 09:00:01  1.0</span>
<span class="go">2013-01-01 09:00:02  2.0</span>
<span class="go">2013-01-01 09:00:03  NaN</span>
<span class="go">2013-01-01 09:00:04  4.0</span>
</pre></div>
</div>
<p>This is a regular frequency index. Using an integer window parameter works to roll along the window frequency.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [60]: </span><span class="n">dft</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[60]: </span><span class="go"></span>
<span class="go">                       B</span>
<span class="go">2013-01-01 09:00:00  NaN</span>
<span class="go">2013-01-01 09:00:01  1.0</span>
<span class="go">2013-01-01 09:00:02  3.0</span>
<span class="go">2013-01-01 09:00:03  NaN</span>
<span class="go">2013-01-01 09:00:04  NaN</span>

<span class="gp">In [61]: </span><span class="n">dft</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[61]: </span><span class="go"></span>
<span class="go">                       B</span>
<span class="go">2013-01-01 09:00:00  0.0</span>
<span class="go">2013-01-01 09:00:01  1.0</span>
<span class="go">2013-01-01 09:00:02  3.0</span>
<span class="go">2013-01-01 09:00:03  2.0</span>
<span class="go">2013-01-01 09:00:04  4.0</span>
</pre></div>
</div>
<p>Specifying an offset allows a more intuitive specification of the rolling frequency.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [62]: </span><span class="n">dft</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s1">&#39;2s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[62]: </span><span class="go"></span>
<span class="go">                       B</span>
<span class="go">2013-01-01 09:00:00  0.0</span>
<span class="go">2013-01-01 09:00:01  1.0</span>
<span class="go">2013-01-01 09:00:02  3.0</span>
<span class="go">2013-01-01 09:00:03  2.0</span>
<span class="go">2013-01-01 09:00:04  4.0</span>
</pre></div>
</div>
<p>Using a non-regular, but still monotonic index, rolling with an integer window does not impart any special calculation.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [63]: </span><span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">]},</span>
<span class="gp">   ....: </span>                   <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:00&#39;</span><span class="p">),</span>
<span class="gp">   ....: </span>                                   <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:02&#39;</span><span class="p">),</span>
<span class="gp">   ....: </span>                                   <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:03&#39;</span><span class="p">),</span>
<span class="gp">   ....: </span>                                   <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:05&#39;</span><span class="p">),</span>
<span class="gp">   ....: </span>                                   <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:06&#39;</span><span class="p">)],</span>
<span class="gp">   ....: </span>                                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">))</span>
<span class="gp">   ....: </span>

<span class="gp">In [64]: </span><span class="n">dft</span>
<span class="gh">Out[64]: </span><span class="go"></span>
<span class="go">                       B</span>
<span class="go">foo                     </span>
<span class="go">2013-01-01 09:00:00  0.0</span>
<span class="go">2013-01-01 09:00:02  1.0</span>
<span class="go">2013-01-01 09:00:03  2.0</span>
<span class="go">2013-01-01 09:00:05  NaN</span>
<span class="go">2013-01-01 09:00:06  4.0</span>

<span class="gp">In [65]: </span><span class="n">dft</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[65]: </span><span class="go"></span>
<span class="go">                       B</span>
<span class="go">foo                     </span>
<span class="go">2013-01-01 09:00:00  NaN</span>
<span class="go">2013-01-01 09:00:02  1.0</span>
<span class="go">2013-01-01 09:00:03  3.0</span>
<span class="go">2013-01-01 09:00:05  NaN</span>
<span class="go">2013-01-01 09:00:06  NaN</span>
</pre></div>
</div>
<p>Using the time-specification generates variable windows for this sparse data.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [66]: </span><span class="n">dft</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s1">&#39;2s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[66]: </span><span class="go"></span>
<span class="go">                       B</span>
<span class="go">foo                     </span>
<span class="go">2013-01-01 09:00:00  0.0</span>
<span class="go">2013-01-01 09:00:02  1.0</span>
<span class="go">2013-01-01 09:00:03  3.0</span>
<span class="go">2013-01-01 09:00:05  NaN</span>
<span class="go">2013-01-01 09:00:06  4.0</span>
</pre></div>
</div>
<p>Furthermore, we now allow an optional <code class="docutils literal notranslate"><span class="pre">on</span></code> parameter to specify a column (rather than the
default of the index) in a DataFrame.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [67]: </span><span class="n">dft</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="gp">In [68]: </span><span class="n">dft</span>
<span class="gh">Out[68]: </span><span class="go"></span>
<span class="go">                  foo    B</span>
<span class="go">0 2013-01-01 09:00:00  0.0</span>
<span class="go">1 2013-01-01 09:00:02  1.0</span>
<span class="go">2 2013-01-01 09:00:03  2.0</span>
<span class="go">3 2013-01-01 09:00:05  NaN</span>
<span class="go">4 2013-01-01 09:00:06  4.0</span>

<span class="gp">In [69]: </span><span class="n">dft</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s1">&#39;2s&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[69]: </span><span class="go"></span>
<span class="go">                  foo    B</span>
<span class="go">0 2013-01-01 09:00:00  0.0</span>
<span class="go">1 2013-01-01 09:00:02  1.0</span>
<span class="go">2 2013-01-01 09:00:03  3.0</span>
<span class="go">3 2013-01-01 09:00:05  NaN</span>
<span class="go">4 2013-01-01 09:00:06  4.0</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-window-rolling">
<span id="stats-custom-rolling-window"></span><h3>Custom window rolling<a class="headerlink" href="#custom-window-rolling" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.0.</span></p>
</div>
<p>In addition to accepting an integer or offset as a <code class="docutils literal notranslate"><span class="pre">window</span></code> argument, <code class="docutils literal notranslate"><span class="pre">rolling</span></code> also accepts
a <code class="docutils literal notranslate"><span class="pre">BaseIndexer</span></code> subclass that allows a user to define a custom method for calculating window bounds.
The <code class="docutils literal notranslate"><span class="pre">BaseIndexer</span></code> subclass will need to define a <code class="docutils literal notranslate"><span class="pre">get_window_bounds</span></code> method that returns
a tuple of two arrays, the first being the starting indices of the windows and second being the
ending indices of the windows. Additionally, <code class="docutils literal notranslate"><span class="pre">num_values</span></code>, <code class="docutils literal notranslate"><span class="pre">min_periods</span></code>, <code class="docutils literal notranslate"><span class="pre">center</span></code>, <code class="docutils literal notranslate"><span class="pre">closed</span></code>
and will automatically be passed to <code class="docutils literal notranslate"><span class="pre">get_window_bounds</span></code> and the defined method must
always accept these arguments.</p>
<p>For example, if we have the following <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [70]: </span><span class="n">use_expanding</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>

<span class="gp">In [71]: </span><span class="n">use_expanding</span>
<span class="gh">Out[71]: </span><span class="go">[True, False, True, False, True]</span>

<span class="gp">In [72]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)})</span>

<span class="gp">In [73]: </span><span class="n">df</span>
<span class="gh">Out[73]: </span><span class="go"></span>
<span class="go">   values</span>
<span class="go">0       0</span>
<span class="go">1       1</span>
<span class="go">2       2</span>
<span class="go">3       3</span>
<span class="go">4       4</span>
</pre></div>
</div>
<p>and we want to use an expanding window where <code class="docutils literal notranslate"><span class="pre">use_expanding</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> otherwise a window of size
1, we can create the following <code class="docutils literal notranslate"><span class="pre">BaseIndexer</span></code>:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">pandas.api.indexers</span> <span class="kn">import</span> <span class="n">BaseIndexer</span>
<span class="go">...:</span>
<span class="go">...: class CustomIndexer(BaseIndexer):</span>
<span class="go">...:</span>
<span class="go">...:    def get_window_bounds(self, num_values, min_periods, center, closed):</span>
<span class="go">...:        start = np.empty(num_values, dtype=np.int64)</span>
<span class="go">...:        end = np.empty(num_values, dtype=np.int64)</span>
<span class="go">...:        for i in range(num_values):</span>
<span class="go">...:            if self.use_expanding[i]:</span>
<span class="go">...:                start[i] = 0</span>
<span class="go">...:                end[i] = i + 1</span>
<span class="go">...:            else:</span>
<span class="go">...:                start[i] = i</span>
<span class="go">...:                end[i] = i + self.window_size</span>
<span class="go">...:        return start, end</span>
<span class="go">...:</span>

<span class="gp">In [3]: </span><span class="n">indexer</span> <span class="o">=</span> <span class="n">CustomIndexer</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">use_expanding</span><span class="o">=</span><span class="n">use_expanding</span><span class="p">)</span>

<span class="gp">In [4]: </span><span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">indexer</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[4]:</span>
<span class="go">    values</span>
<span class="go">0     0.0</span>
<span class="go">1     1.0</span>
<span class="go">2     3.0</span>
<span class="go">3     3.0</span>
<span class="go">4    10.0</span>
</pre></div>
</div>
</div>
<div class="section" id="rolling-window-endpoints">
<span id="stats-rolling-window-endpoints"></span><h3>Rolling window endpoints<a class="headerlink" href="#rolling-window-endpoints" title="Permalink to this headline">¶</a></h3>
<p>The inclusion of the interval endpoints in rolling window calculations can be specified with the <code class="docutils literal notranslate"><span class="pre">closed</span></code>
parameter:</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 25%" />
<col style="width: 38%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">closed</span></code></p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default for</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">right</span></code></p></td>
<td><p>close right endpoint</p></td>
<td><p>time-based windows</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">left</span></code></p></td>
<td><p>close left endpoint</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">both</span></code></p></td>
<td><p>close both endpoints</p></td>
<td><p>fixed windows</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">neither</span></code></p></td>
<td><p>open endpoints</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>For example, having the right endpoint open is useful in many problems that require that there is no contamination
from present information back to past information. This allows the rolling window to compute statistics
“up to that point in time”, but not including that point in time.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [74]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
<span class="gp">   ....: </span>                  <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:01&#39;</span><span class="p">),</span>
<span class="gp">   ....: </span>                         <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:02&#39;</span><span class="p">),</span>
<span class="gp">   ....: </span>                         <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:03&#39;</span><span class="p">),</span>
<span class="gp">   ....: </span>                         <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:04&#39;</span><span class="p">),</span>
<span class="gp">   ....: </span>                         <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130101 09:00:06&#39;</span><span class="p">)])</span>
<span class="gp">   ....: </span>

<span class="gp">In [75]: </span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s1">&#39;2s&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># default</span>

<span class="gp">In [76]: </span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;both&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s1">&#39;2s&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="gp">In [77]: </span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s1">&#39;2s&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="gp">In [78]: </span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;neither&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s1">&#39;2s&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;neither&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="gp">In [79]: </span><span class="n">df</span>
<span class="gh">Out[79]: </span><span class="go"></span>
<span class="go">                     x  right  both  left  neither</span>
<span class="go">2013-01-01 09:00:01  1    1.0   1.0   NaN      NaN</span>
<span class="go">2013-01-01 09:00:02  1    2.0   2.0   1.0      1.0</span>
<span class="go">2013-01-01 09:00:03  1    2.0   3.0   2.0      1.0</span>
<span class="go">2013-01-01 09:00:04  1    2.0   3.0   2.0      1.0</span>
<span class="go">2013-01-01 09:00:06  1    1.0   2.0   1.0      NaN</span>
</pre></div>
</div>
<p>Currently, this feature is only implemented for time-based windows.
For fixed windows, the closed parameter cannot be set and the rolling window will always have both endpoints closed.</p>
</div>
<div class="section" id="time-aware-rolling-vs-resampling">
<span id="stats-moments-ts-versus-resampling"></span><h3>Time-aware rolling vs. resampling<a class="headerlink" href="#time-aware-rolling-vs-resampling" title="Permalink to this headline">¶</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">.rolling()</span></code> with a time-based index is quite similar to <a class="reference internal" href="timeseries.html#timeseries-resampling"><span class="std std-ref">resampling</span></a>. They
both operate and perform reductive operations on time-indexed pandas objects.</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">.rolling()</span></code> with an offset. The offset is a time-delta. Take a backwards-in-time looking window, and
aggregate all of the values in that window (including the end-point, but not the start-point). This is the new value
at that point in the result. These are variable sized windows in time-space for each point of the input. You will get
a same sized result as the input.</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">.resample()</span></code> with an offset. Construct a new index that is the frequency of the offset. For each frequency
bin, aggregate points from the input within a backwards-in-time looking window that fall in that bin. The result of this
aggregation is the output for that frequency point. The windows are fixed size in the frequency space. Your result
will have the shape of a regular frequency between the min and the max of the original input object.</p>
<p>To summarize, <code class="docutils literal notranslate"><span class="pre">.rolling()</span></code> is a time-based window operation, while <code class="docutils literal notranslate"><span class="pre">.resample()</span></code> is a frequency-based window operation.</p>
</div>
<div class="section" id="centering-windows">
<h3>Centering windows<a class="headerlink" href="#centering-windows" title="Permalink to this headline">¶</a></h3>
<p>By default the labels are set to the right edge of the window, but a
<code class="docutils literal notranslate"><span class="pre">center</span></code> keyword is available so the labels can be set at the center.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [80]: </span><span class="n">ser</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[80]: </span><span class="go"></span>
<span class="go">2000-01-01         NaN</span>
<span class="go">2000-01-02         NaN</span>
<span class="go">2000-01-03         NaN</span>
<span class="go">2000-01-04         NaN</span>
<span class="go">2000-01-05   -0.841164</span>
<span class="go">2000-01-06   -0.779948</span>
<span class="go">2000-01-07   -0.565487</span>
<span class="go">2000-01-08   -0.502815</span>
<span class="go">2000-01-09   -0.553755</span>
<span class="go">2000-01-10   -0.472211</span>
<span class="go">Freq: D, dtype: float64</span>

<span class="gp">In [81]: </span><span class="n">ser</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[81]: </span><span class="go"></span>
<span class="go">2000-01-01         NaN</span>
<span class="go">2000-01-02         NaN</span>
<span class="go">2000-01-03   -0.841164</span>
<span class="go">2000-01-04   -0.779948</span>
<span class="go">2000-01-05   -0.565487</span>
<span class="go">2000-01-06   -0.502815</span>
<span class="go">2000-01-07   -0.553755</span>
<span class="go">2000-01-08   -0.472211</span>
<span class="go">2000-01-09         NaN</span>
<span class="go">2000-01-10         NaN</span>
<span class="go">Freq: D, dtype: float64</span>
</pre></div>
</div>
</div>
<div class="section" id="binary-window-functions">
<span id="stats-moments-binary"></span><h3>Binary window functions<a class="headerlink" href="#binary-window-functions" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">cov()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">corr()</span></code> can compute moving window statistics about
two <code class="docutils literal notranslate"><span class="pre">Series</span></code> or any combination of <code class="docutils literal notranslate"><span class="pre">DataFrame/Series</span></code> or
<code class="docutils literal notranslate"><span class="pre">DataFrame/DataFrame</span></code>. Here is the behavior in each case:</p>
<ul class="simple">
<li><p>two <code class="docutils literal notranslate"><span class="pre">Series</span></code>: compute the statistic for the pairing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame/Series</span></code>: compute the statistics for each column of the DataFrame
with the passed Series, thus returning a DataFrame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame/DataFrame</span></code>: by default compute the statistic for matching column
names, returning a DataFrame. If the keyword argument <code class="docutils literal notranslate"><span class="pre">pairwise=True</span></code> is
passed then computes the statistic for each pair of columns, returning a
<code class="docutils literal notranslate"><span class="pre">MultiIndexed</span> <span class="pre">DataFrame</span></code> whose <code class="docutils literal notranslate"><span class="pre">index</span></code> are the dates in question (see <a class="reference internal" href="#stats-moments-corr-pairwise"><span class="std std-ref">the next section</span></a>).</p></li>
</ul>
<p>For example:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [82]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">   ....: </span>                  <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
<span class="gp">   ....: </span>                  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">])</span>
<span class="gp">   ....: </span>

<span class="gp">In [83]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

<span class="gp">In [84]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>

<span class="gp">In [85]: </span><span class="n">df2</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="gh">Out[85]: </span><span class="go"></span>
<span class="go">                   A    B         C         D</span>
<span class="go">2000-01-01       NaN  NaN       NaN       NaN</span>
<span class="go">2000-01-02       NaN  NaN       NaN       NaN</span>
<span class="go">2000-01-03       NaN  NaN       NaN       NaN</span>
<span class="go">2000-01-04       NaN  NaN       NaN       NaN</span>
<span class="go">2000-01-05  0.768775  1.0 -0.977990  0.800252</span>
<span class="go">...              ...  ...       ...       ...</span>
<span class="go">2000-01-16  0.691078  1.0  0.807450 -0.939302</span>
<span class="go">2000-01-17  0.274506  1.0  0.582601 -0.902954</span>
<span class="go">2000-01-18  0.330459  1.0  0.515707 -0.545268</span>
<span class="go">2000-01-19  0.046756  1.0 -0.104334 -0.419799</span>
<span class="go">2000-01-20 -0.328241  1.0 -0.650974 -0.777777</span>

<span class="go">[20 rows x 4 columns]</span>
</pre></div>
</div>
</div>
<div class="section" id="computing-rolling-pairwise-covariances-and-correlations">
<span id="stats-moments-corr-pairwise"></span><h3>Computing rolling pairwise covariances and correlations<a class="headerlink" href="#computing-rolling-pairwise-covariances-and-correlations" title="Permalink to this headline">¶</a></h3>
<p>In financial data analysis and other fields it’s common to compute covariance
and correlation matrices for a collection of time series. Often one is also
interested in moving-window covariance and correlation matrices. This can be
done by passing the <code class="docutils literal notranslate"><span class="pre">pairwise</span></code> keyword argument, which in the case of
<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> inputs will yield a MultiIndexed <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> whose <code class="docutils literal notranslate"><span class="pre">index</span></code> are the dates in
question. In the case of a single DataFrame argument the <code class="docutils literal notranslate"><span class="pre">pairwise</span></code> argument
can even be omitted:</p>
<div class="alert alert-info">
<p class="admonition-title">Note</p>
<p>Missing values are ignored and each entry is computed using the pairwise
complete observations.  Please see the <a class="reference internal" href="#computation-covariance"><span class="std std-ref">covariance section</span></a> for <a class="reference internal" href="#computation-covariance-caveats"><span class="std std-ref">caveats</span></a> associated with this method of
calculating covariance and correlation matrices.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [86]: </span><span class="n">covs</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="gp">   ....: </span>                           <span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]],</span> <span class="n">pairwise</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="gp">   ....: </span>

<span class="gp">In [87]: </span><span class="n">covs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2002-09-22&#39;</span><span class="p">:]</span>
<span class="gh">Out[87]: </span><span class="go"></span>
<span class="go">                     B         C         D</span>
<span class="go">2002-09-22 A  1.367467  8.676734 -8.047366</span>
<span class="go">           B  3.067315  0.865946 -1.052533</span>
<span class="go">           C  0.865946  7.739761 -4.943924</span>
<span class="go">2002-09-23 A  0.910343  8.669065 -8.443062</span>
<span class="go">           B  2.625456  0.565152 -0.907654</span>
<span class="go">           C  0.565152  7.825521 -5.367526</span>
<span class="go">2002-09-24 A  0.463332  8.514509 -8.776514</span>
<span class="go">           B  2.306695  0.267746 -0.732186</span>
<span class="go">           C  0.267746  7.771425 -5.696962</span>
<span class="go">2002-09-25 A  0.467976  8.198236 -9.162599</span>
<span class="go">           B  2.307129  0.267287 -0.754080</span>
<span class="go">           C  0.267287  7.466559 -5.822650</span>
<span class="go">2002-09-26 A  0.545781  7.899084 -9.326238</span>
<span class="go">           B  2.311058  0.322295 -0.844451</span>
<span class="go">           C  0.322295  7.038237 -5.684445</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [88]: </span><span class="n">correls</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="gp">In [89]: </span><span class="n">correls</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2002-09-22&#39;</span><span class="p">:]</span>
<span class="gh">Out[89]: </span><span class="go"></span>
<span class="go">                     A         B         C         D</span>
<span class="go">2002-09-22 A  1.000000  0.186397  0.744551 -0.769767</span>
<span class="go">           B  0.186397  1.000000  0.177725 -0.240802</span>
<span class="go">           C  0.744551  0.177725  1.000000 -0.712051</span>
<span class="go">           D -0.769767 -0.240802 -0.712051  1.000000</span>
<span class="go">2002-09-23 A  1.000000  0.134723  0.743113 -0.758758</span>
<span class="go">...                ...       ...       ...       ...</span>
<span class="go">2002-09-25 D -0.739160 -0.164179 -0.704686  1.000000</span>
<span class="go">2002-09-26 A  1.000000  0.087756  0.727792 -0.736562</span>
<span class="go">           B  0.087756  1.000000  0.079913 -0.179477</span>
<span class="go">           C  0.727792  0.079913  1.000000 -0.692303</span>
<span class="go">           D -0.736562 -0.179477 -0.692303  1.000000</span>

<span class="go">[20 rows x 4 columns]</span>
</pre></div>
</div>
<p>You can efficiently retrieve the time series of correlations between two
columns by reshaping and indexing:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [90]: </span><span class="n">correls</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">1</span><span class="p">)[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gh">Out[90]: </span><span class="go">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f65bd171048&gt;</span>
</pre></div>
</div>
<img alt="../_images/rolling_corr_pairwise_ex.png" src="../_images/rolling_corr_pairwise_ex.png" />
</div>
</div>
<div class="section" id="aggregation">
<span id="stats-aggregate"></span><h2>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">¶</a></h2>
<p>Once the <code class="docutils literal notranslate"><span class="pre">Rolling</span></code>, <code class="docutils literal notranslate"><span class="pre">Expanding</span></code> or <code class="docutils literal notranslate"><span class="pre">EWM</span></code> objects have been created, several methods are available to
perform multiple computations on the data. These operations are similar to the <a class="reference internal" href="../getting_started/basics.html#basics-aggregate"><span class="std std-ref">aggregating API</span></a>,
<a class="reference internal" href="groupby.html#groupby-aggregate"><span class="std std-ref">groupby API</span></a>, and <a class="reference internal" href="timeseries.html#timeseries-aggregate"><span class="std std-ref">resample API</span></a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [91]: </span><span class="n">dfa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">   ....: </span>                   <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
<span class="gp">   ....: </span>                   <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>
<span class="gp">   ....: </span>

<span class="gp">In [92]: </span><span class="n">r</span> <span class="o">=</span> <span class="n">dfa</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">In [93]: </span><span class="n">r</span>
<span class="gh">Out[93]: </span><span class="go">Rolling [window=60,min_periods=1,center=False,axis=0]</span>
</pre></div>
</div>
<p>We can aggregate by passing a function to the entire DataFrame, or select a
Series (or multiple Series) via standard <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [94]: </span><span class="n">r</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<span class="gh">Out[94]: </span><span class="go"></span>
<span class="go">                   A          B         C</span>
<span class="go">2000-01-01 -0.289838  -0.370545 -1.284206</span>
<span class="go">2000-01-02 -0.216612  -1.675528 -1.169415</span>
<span class="go">2000-01-03  1.154661  -1.634017 -1.566620</span>
<span class="go">2000-01-04  2.969393  -4.003274 -1.816179</span>
<span class="go">2000-01-05  4.690630  -4.682017 -2.717209</span>
<span class="go">...              ...        ...       ...</span>
<span class="go">2002-09-22  2.860036  -9.270337  6.415245</span>
<span class="go">2002-09-23  3.510163  -8.151439  5.177219</span>
<span class="go">2002-09-24  6.524983 -10.168078  5.792639</span>
<span class="go">2002-09-25  6.409626  -9.956226  5.704050</span>
<span class="go">2002-09-26  5.093787  -7.074515  6.905823</span>

<span class="go">[1000 rows x 3 columns]</span>

<span class="gp">In [95]: </span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<span class="gh">Out[95]: </span><span class="go"></span>
<span class="go">2000-01-01   -0.289838</span>
<span class="go">2000-01-02   -0.216612</span>
<span class="go">2000-01-03    1.154661</span>
<span class="go">2000-01-04    2.969393</span>
<span class="go">2000-01-05    4.690630</span>
<span class="go">                ...   </span>
<span class="go">2002-09-22    2.860036</span>
<span class="go">2002-09-23    3.510163</span>
<span class="go">2002-09-24    6.524983</span>
<span class="go">2002-09-25    6.409626</span>
<span class="go">2002-09-26    5.093787</span>
<span class="go">Freq: D, Name: A, Length: 1000, dtype: float64</span>

<span class="gp">In [96]: </span><span class="n">r</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<span class="gh">Out[96]: </span><span class="go"></span>
<span class="go">                   A          B</span>
<span class="go">2000-01-01 -0.289838  -0.370545</span>
<span class="go">2000-01-02 -0.216612  -1.675528</span>
<span class="go">2000-01-03  1.154661  -1.634017</span>
<span class="go">2000-01-04  2.969393  -4.003274</span>
<span class="go">2000-01-05  4.690630  -4.682017</span>
<span class="go">...              ...        ...</span>
<span class="go">2002-09-22  2.860036  -9.270337</span>
<span class="go">2002-09-23  3.510163  -8.151439</span>
<span class="go">2002-09-24  6.524983 -10.168078</span>
<span class="go">2002-09-25  6.409626  -9.956226</span>
<span class="go">2002-09-26  5.093787  -7.074515</span>

<span class="go">[1000 rows x 2 columns]</span>
</pre></div>
</div>
<p>As you can see, the result of the aggregation will have the selected columns, or all
columns if none are selected.</p>
<div class="section" id="applying-multiple-functions">
<span id="stats-aggregate-multifunc"></span><h3>Applying multiple functions<a class="headerlink" href="#applying-multiple-functions" title="Permalink to this headline">¶</a></h3>
<p>With windowed <code class="docutils literal notranslate"><span class="pre">Series</span></code> you can also pass a list of functions to do
aggregation with, outputting a DataFrame:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [97]: </span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>
<span class="gh">Out[97]: </span><span class="go"></span>
<span class="go">                 sum      mean       std</span>
<span class="go">2000-01-01 -0.289838 -0.289838       NaN</span>
<span class="go">2000-01-02 -0.216612 -0.108306  0.256725</span>
<span class="go">2000-01-03  1.154661  0.384887  0.873311</span>
<span class="go">2000-01-04  2.969393  0.742348  1.009734</span>
<span class="go">2000-01-05  4.690630  0.938126  0.977914</span>
<span class="go">...              ...       ...       ...</span>
<span class="go">2002-09-22  2.860036  0.047667  1.132051</span>
<span class="go">2002-09-23  3.510163  0.058503  1.134296</span>
<span class="go">2002-09-24  6.524983  0.108750  1.144204</span>
<span class="go">2002-09-25  6.409626  0.106827  1.142913</span>
<span class="go">2002-09-26  5.093787  0.084896  1.151416</span>

<span class="go">[1000 rows x 3 columns]</span>
</pre></div>
</div>
<p>On a windowed DataFrame, you can pass a list of functions to apply to each
column, which produces an aggregated result with a hierarchical index:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [98]: </span><span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">])</span>
<span class="gh">Out[98]: </span><span class="go"></span>
<span class="go">                   A                    B                   C          </span>
<span class="go">                 sum      mean        sum      mean       sum      mean</span>
<span class="go">2000-01-01 -0.289838 -0.289838  -0.370545 -0.370545 -1.284206 -1.284206</span>
<span class="go">2000-01-02 -0.216612 -0.108306  -1.675528 -0.837764 -1.169415 -0.584708</span>
<span class="go">2000-01-03  1.154661  0.384887  -1.634017 -0.544672 -1.566620 -0.522207</span>
<span class="go">2000-01-04  2.969393  0.742348  -4.003274 -1.000819 -1.816179 -0.454045</span>
<span class="go">2000-01-05  4.690630  0.938126  -4.682017 -0.936403 -2.717209 -0.543442</span>
<span class="go">...              ...       ...        ...       ...       ...       ...</span>
<span class="go">2002-09-22  2.860036  0.047667  -9.270337 -0.154506  6.415245  0.106921</span>
<span class="go">2002-09-23  3.510163  0.058503  -8.151439 -0.135857  5.177219  0.086287</span>
<span class="go">2002-09-24  6.524983  0.108750 -10.168078 -0.169468  5.792639  0.096544</span>
<span class="go">2002-09-25  6.409626  0.106827  -9.956226 -0.165937  5.704050  0.095068</span>
<span class="go">2002-09-26  5.093787  0.084896  -7.074515 -0.117909  6.905823  0.115097</span>

<span class="go">[1000 rows x 6 columns]</span>
</pre></div>
</div>
<p>Passing a dict of functions has different behavior by default, see the next
section.</p>
</div>
<div class="section" id="applying-different-functions-to-dataframe-columns">
<h3>Applying different functions to DataFrame columns<a class="headerlink" href="#applying-different-functions-to-dataframe-columns" title="Permalink to this headline">¶</a></h3>
<p>By passing a dict to <code class="docutils literal notranslate"><span class="pre">aggregate</span></code> you can apply a different aggregation to the
columns of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [99]: </span><span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)})</span>
<span class="gh">Out[99]: </span><span class="go"></span>
<span class="go">                   A         B</span>
<span class="go">2000-01-01 -0.289838       NaN</span>
<span class="go">2000-01-02 -0.216612  0.660747</span>
<span class="go">2000-01-03  1.154661  0.689929</span>
<span class="go">2000-01-04  2.969393  1.072199</span>
<span class="go">2000-01-05  4.690630  0.939657</span>
<span class="go">...              ...       ...</span>
<span class="go">2002-09-22  2.860036  1.113208</span>
<span class="go">2002-09-23  3.510163  1.132381</span>
<span class="go">2002-09-24  6.524983  1.080963</span>
<span class="go">2002-09-25  6.409626  1.082911</span>
<span class="go">2002-09-26  5.093787  1.136199</span>

<span class="go">[1000 rows x 2 columns]</span>
</pre></div>
</div>
<p>The function names can also be strings. In order for a string to be valid it
must be implemented on the windowed object</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [100]: </span><span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="s1">&#39;std&#39;</span><span class="p">})</span>
<span class="gh">Out[100]: </span><span class="go"></span>
<span class="go">                   A         B</span>
<span class="go">2000-01-01 -0.289838       NaN</span>
<span class="go">2000-01-02 -0.216612  0.660747</span>
<span class="go">2000-01-03  1.154661  0.689929</span>
<span class="go">2000-01-04  2.969393  1.072199</span>
<span class="go">2000-01-05  4.690630  0.939657</span>
<span class="go">...              ...       ...</span>
<span class="go">2002-09-22  2.860036  1.113208</span>
<span class="go">2002-09-23  3.510163  1.132381</span>
<span class="go">2002-09-24  6.524983  1.080963</span>
<span class="go">2002-09-25  6.409626  1.082911</span>
<span class="go">2002-09-26  5.093787  1.136199</span>

<span class="go">[1000 rows x 2 columns]</span>
</pre></div>
</div>
<p>Furthermore you can pass a nested dict to indicate different aggregations on different columns.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [101]: </span><span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]})</span>
<span class="gh">Out[101]: </span><span class="go"></span>
<span class="go">                   A                   B          </span>
<span class="go">                 sum       std      mean       std</span>
<span class="go">2000-01-01 -0.289838       NaN -0.370545       NaN</span>
<span class="go">2000-01-02 -0.216612  0.256725 -0.837764  0.660747</span>
<span class="go">2000-01-03  1.154661  0.873311 -0.544672  0.689929</span>
<span class="go">2000-01-04  2.969393  1.009734 -1.000819  1.072199</span>
<span class="go">2000-01-05  4.690630  0.977914 -0.936403  0.939657</span>
<span class="go">...              ...       ...       ...       ...</span>
<span class="go">2002-09-22  2.860036  1.132051 -0.154506  1.113208</span>
<span class="go">2002-09-23  3.510163  1.134296 -0.135857  1.132381</span>
<span class="go">2002-09-24  6.524983  1.144204 -0.169468  1.080963</span>
<span class="go">2002-09-25  6.409626  1.142913 -0.165937  1.082911</span>
<span class="go">2002-09-26  5.093787  1.151416 -0.117909  1.136199</span>

<span class="go">[1000 rows x 4 columns]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="expanding-windows">
<span id="stats-moments-expanding"></span><h2>Expanding windows<a class="headerlink" href="#expanding-windows" title="Permalink to this headline">¶</a></h2>
<p>A common alternative to rolling statistics is to use an <em>expanding</em> window,
which yields the value of the statistic with all the data available up to that
point in time.</p>
<p>These follow a similar interface to <code class="docutils literal notranslate"><span class="pre">.rolling</span></code>, with the <code class="docutils literal notranslate"><span class="pre">.expanding</span></code> method
returning an <code class="xref py py-class docutils literal notranslate"><span class="pre">Expanding</span></code> object.</p>
<p>As these calculations are a special case of rolling statistics,
they are implemented in pandas such that the following two calls are equivalent:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [102]: </span><span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span>
<span class="gh">Out[102]: </span><span class="go"></span>
<span class="go">                   A         B         C         D</span>
<span class="go">2000-01-01  0.314226 -0.001675  0.071823  0.892566</span>
<span class="go">2000-01-02  0.654522 -0.171495  0.179278  0.853361</span>
<span class="go">2000-01-03  0.708733 -0.064489 -0.238271  1.371111</span>
<span class="go">2000-01-04  0.987613  0.163472 -0.919693  1.566485</span>
<span class="go">2000-01-05  1.426971  0.288267 -1.358877  1.808650</span>

<span class="gp">In [103]: </span><span class="n">df</span><span class="o">.</span><span class="n">expanding</span><span class="p">(</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span>
<span class="gh">Out[103]: </span><span class="go"></span>
<span class="go">                   A         B         C         D</span>
<span class="go">2000-01-01  0.314226 -0.001675  0.071823  0.892566</span>
<span class="go">2000-01-02  0.654522 -0.171495  0.179278  0.853361</span>
<span class="go">2000-01-03  0.708733 -0.064489 -0.238271  1.371111</span>
<span class="go">2000-01-04  0.987613  0.163472 -0.919693  1.566485</span>
<span class="go">2000-01-05  1.426971  0.288267 -1.358877  1.808650</span>
</pre></div>
</div>
<p>These have a similar set of methods to <code class="docutils literal notranslate"><span class="pre">.rolling</span></code> methods.</p>
<div class="section" id="id1">
<h3>Method summary<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given table">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">count()</span></code></p></td>
<td><p>Number of non-null observations</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">sum()</span></code></p></td>
<td><p>Sum of values</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">mean()</span></code></p></td>
<td><p>Mean of values</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">median()</span></code></p></td>
<td><p>Arithmetic median of values</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">min()</span></code></p></td>
<td><p>Minimum</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">max()</span></code></p></td>
<td><p>Maximum</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">std()</span></code></p></td>
<td><p>Unbiased standard deviation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">var()</span></code></p></td>
<td><p>Unbiased variance</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">skew()</span></code></p></td>
<td><p>Unbiased skewness (3rd moment)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">kurt()</span></code></p></td>
<td><p>Unbiased kurtosis (4th moment)</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">quantile()</span></code></p></td>
<td><p>Sample quantile (value at %)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></p></td>
<td><p>Generic apply</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">cov()</span></code></p></td>
<td><p>Unbiased covariance (binary)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">corr()</span></code></p></td>
<td><p>Correlation (binary)</p></td>
</tr>
</tbody>
</table>
<p>Aside from not having a <code class="docutils literal notranslate"><span class="pre">window</span></code> parameter, these functions have the same
interfaces as their <code class="docutils literal notranslate"><span class="pre">.rolling</span></code> counterparts. Like above, the parameters they
all accept are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">min_periods</span></code>: threshold of non-null data points to require. Defaults to
minimum needed to compute statistic. No <code class="docutils literal notranslate"><span class="pre">NaNs</span></code> will be output once
<code class="docutils literal notranslate"><span class="pre">min_periods</span></code> non-null data points have been seen.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">center</span></code>: boolean, whether to set the labels at the center (default is False).</p></li>
</ul>
<div class="alert alert-info" id="stats-moments-expanding-note">
<p class="admonition-title">Note</p>
<p>The output of the <code class="docutils literal notranslate"><span class="pre">.rolling</span></code> and <code class="docutils literal notranslate"><span class="pre">.expanding</span></code> methods do not return a
<code class="docutils literal notranslate"><span class="pre">NaN</span></code> if there are at least <code class="docutils literal notranslate"><span class="pre">min_periods</span></code> non-null values in the current
window. For example:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [104]: </span><span class="n">sn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="gp">In [105]: </span><span class="n">sn</span>
<span class="gh">Out[105]: </span><span class="go"></span>
<span class="go">0    1.0</span>
<span class="go">1    2.0</span>
<span class="go">2    NaN</span>
<span class="go">3    3.0</span>
<span class="go">4    NaN</span>
<span class="go">5    4.0</span>
<span class="go">dtype: float64</span>

<span class="gp">In [106]: </span><span class="n">sn</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gh">Out[106]: </span><span class="go"></span>
<span class="go">0    NaN</span>
<span class="go">1    2.0</span>
<span class="go">2    NaN</span>
<span class="go">3    NaN</span>
<span class="go">4    NaN</span>
<span class="go">5    NaN</span>
<span class="go">dtype: float64</span>

<span class="gp">In [107]: </span><span class="n">sn</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gh">Out[107]: </span><span class="go"></span>
<span class="go">0    1.0</span>
<span class="go">1    2.0</span>
<span class="go">2    2.0</span>
<span class="go">3    3.0</span>
<span class="go">4    3.0</span>
<span class="go">5    4.0</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>In case of expanding functions, this differs from <code class="xref py py-meth docutils literal notranslate"><span class="pre">cumsum()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">cumprod()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">cummax()</span></code>,
and <code class="xref py py-meth docutils literal notranslate"><span class="pre">cummin()</span></code>, which return <code class="docutils literal notranslate"><span class="pre">NaN</span></code> in the output wherever
a <code class="docutils literal notranslate"><span class="pre">NaN</span></code> is encountered in the input. In order to match the output of <code class="docutils literal notranslate"><span class="pre">cumsum</span></code>
with <code class="docutils literal notranslate"><span class="pre">expanding</span></code>, use <code class="xref py py-meth docutils literal notranslate"><span class="pre">fillna()</span></code>:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [108]: </span><span class="n">sn</span><span class="o">.</span><span class="n">expanding</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[108]: </span><span class="go"></span>
<span class="go">0     1.0</span>
<span class="go">1     3.0</span>
<span class="go">2     3.0</span>
<span class="go">3     6.0</span>
<span class="go">4     6.0</span>
<span class="go">5    10.0</span>
<span class="go">dtype: float64</span>

<span class="gp">In [109]: </span><span class="n">sn</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="gh">Out[109]: </span><span class="go"></span>
<span class="go">0     1.0</span>
<span class="go">1     3.0</span>
<span class="go">2     NaN</span>
<span class="go">3     6.0</span>
<span class="go">4     NaN</span>
<span class="go">5    10.0</span>
<span class="go">dtype: float64</span>

<span class="gp">In [110]: </span><span class="n">sn</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
<span class="gh">Out[110]: </span><span class="go"></span>
<span class="go">0     1.0</span>
<span class="go">1     3.0</span>
<span class="go">2     3.0</span>
<span class="go">3     6.0</span>
<span class="go">4     6.0</span>
<span class="go">5    10.0</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
</div>
<p>An expanding window statistic will be more stable (and less responsive) than
its rolling window counterpart as the increasing window size decreases the
relative impact of an individual data point. As an example, here is the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">mean()</span></code> output for the previous time series dataset:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [111]: </span><span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="gh">Out[111]: </span><span class="go">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f6589c770b8&gt;</span>

<span class="gp">In [112]: </span><span class="n">s</span><span class="o">.</span><span class="n">expanding</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="gh">Out[112]: </span><span class="go">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f6589c770b8&gt;</span>
</pre></div>
</div>
<img alt="../_images/expanding_mean_frame.png" src="../_images/expanding_mean_frame.png" />
</div>
</div>
<div class="section" id="exponentially-weighted-windows">
<span id="stats-moments-exponentially-weighted"></span><h2>Exponentially weighted windows<a class="headerlink" href="#exponentially-weighted-windows" title="Permalink to this headline">¶</a></h2>
<p>A related set of functions are exponentially weighted versions of several of
the above statistics. A similar interface to <code class="docutils literal notranslate"><span class="pre">.rolling</span></code> and <code class="docutils literal notranslate"><span class="pre">.expanding</span></code> is accessed
through the <code class="docutils literal notranslate"><span class="pre">.ewm</span></code> method to receive an <code class="xref py py-class docutils literal notranslate"><span class="pre">EWM</span></code> object.
A number of expanding EW (exponentially weighted)
methods are provided:</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">mean()</span></code></p></td>
<td><p>EW moving average</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">var()</span></code></p></td>
<td><p>EW moving variance</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">std()</span></code></p></td>
<td><p>EW moving standard deviation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">corr()</span></code></p></td>
<td><p>EW moving correlation</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">cov()</span></code></p></td>
<td><p>EW moving covariance</p></td>
</tr>
</tbody>
</table>
<p>In general, a weighted moving average is calculated as</p>
<div class="math notranslate nohighlight">
\[y_t = \frac{\sum_{i=0}^t w_i x_{t-i}}{\sum_{i=0}^t w_i},\]</div>
<p>where <span class="math notranslate nohighlight">\(x_t\)</span> is the input, <span class="math notranslate nohighlight">\(y_t\)</span> is the result and the <span class="math notranslate nohighlight">\(w_i\)</span>
are the weights.</p>
<p>The EW functions support two variants of exponential weights.
The default, <code class="docutils literal notranslate"><span class="pre">adjust=True</span></code>, uses the weights <span class="math notranslate nohighlight">\(w_i = (1 - \alpha)^i\)</span>
which gives</p>
<div class="math notranslate nohighlight">
\[y_t = \frac{x_t + (1 - \alpha)x_{t-1} + (1 - \alpha)^2 x_{t-2} + ...
+ (1 - \alpha)^t x_{0}}{1 + (1 - \alpha) + (1 - \alpha)^2 + ...
+ (1 - \alpha)^t}\]</div>
<p>When <code class="docutils literal notranslate"><span class="pre">adjust=False</span></code> is specified, moving averages are calculated as</p>
<div class="math notranslate nohighlight">
\[\begin{split}y_0 &amp;= x_0 \\
y_t &amp;= (1 - \alpha) y_{t-1} + \alpha x_t,\end{split}\]</div>
<p>which is equivalent to using weights</p>
<div class="math notranslate nohighlight">
\[\begin{split}w_i = \begin{cases}
    \alpha (1 - \alpha)^i &amp; \text{if } i &lt; t \\
    (1 - \alpha)^i        &amp; \text{if } i = t.
\end{cases}\end{split}\]</div>
<div class="alert alert-info">
<p class="admonition-title">Note</p>
<p>These equations are sometimes written in terms of <span class="math notranslate nohighlight">\(\alpha' = 1 - \alpha\)</span>, e.g.</p>
<div class="math notranslate nohighlight">
\[y_t = \alpha' y_{t-1} + (1 - \alpha') x_t.\]</div>
</div>
<p>The difference between the above two variants arises because we are
dealing with series which have finite history. Consider a series of infinite
history, with <code class="docutils literal notranslate"><span class="pre">adjust=True</span></code>:</p>
<div class="math notranslate nohighlight">
\[y_t = \frac{x_t + (1 - \alpha)x_{t-1} + (1 - \alpha)^2 x_{t-2} + ...}
{1 + (1 - \alpha) + (1 - \alpha)^2 + ...}\]</div>
<p>Noting that the denominator is a geometric series with initial term equal to 1
and a ratio of <span class="math notranslate nohighlight">\(1 - \alpha\)</span> we have</p>
<div class="math notranslate nohighlight">
\[\begin{split}y_t &amp;= \frac{x_t + (1 - \alpha)x_{t-1} + (1 - \alpha)^2 x_{t-2} + ...}
{\frac{1}{1 - (1 - \alpha)}}\\
&amp;= [x_t + (1 - \alpha)x_{t-1} + (1 - \alpha)^2 x_{t-2} + ...] \alpha \\
&amp;= \alpha x_t + [(1-\alpha)x_{t-1} + (1 - \alpha)^2 x_{t-2} + ...]\alpha \\
&amp;= \alpha x_t + (1 - \alpha)[x_{t-1} + (1 - \alpha) x_{t-2} + ...]\alpha\\
&amp;= \alpha x_t + (1 - \alpha) y_{t-1}\end{split}\]</div>
<p>which is the same expression as <code class="docutils literal notranslate"><span class="pre">adjust=False</span></code> above and therefore
shows the equivalence of the two variants for infinite series.
When <code class="docutils literal notranslate"><span class="pre">adjust=False</span></code>, we have <span class="math notranslate nohighlight">\(y_0 = x_0\)</span> and
<span class="math notranslate nohighlight">\(y_t = \alpha x_t + (1 - \alpha) y_{t-1}\)</span>.
Therefore, there is an assumption that <span class="math notranslate nohighlight">\(x_0\)</span> is not an ordinary value
but rather an exponentially weighted moment of the infinite series up to that
point.</p>
<p>One must have <span class="math notranslate nohighlight">\(0 &lt; \alpha \leq 1\)</span>, and while it is possible to pass
<span class="math notranslate nohighlight">\(\alpha\)</span> directly, it’s often easier to think about either the
<strong>span</strong>, <strong>center  of mass (com)</strong> or <strong>half-life</strong> of an EW moment:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\alpha =
 \begin{cases}
     \frac{2}{s + 1},               &amp; \text{for span}\ s \geq 1\\
     \frac{1}{1 + c},               &amp; \text{for center of mass}\ c \geq 0\\
     1 - \exp^{\frac{\log 0.5}{h}}, &amp; \text{for half-life}\ h &gt; 0
 \end{cases}\end{split}\]</div>
<p>One must specify precisely one of <strong>span</strong>, <strong>center of mass</strong>, <strong>half-life</strong>
and <strong>alpha</strong> to the EW functions:</p>
<ul class="simple">
<li><p><strong>Span</strong> corresponds to what is commonly called an “N-day EW moving average”.</p></li>
<li><p><strong>Center of mass</strong> has a more physical interpretation and can be thought of
in terms of span: <span class="math notranslate nohighlight">\(c = (s - 1) / 2\)</span>.</p></li>
<li><p><strong>Half-life</strong> is the period of time for the exponential weight to reduce to
one half.</p></li>
<li><p><strong>Alpha</strong> specifies the smoothing factor directly.</p></li>
</ul>
<p>Here is an example for a univariate time series:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [113]: </span><span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="gh">Out[113]: </span><span class="go">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f6589ac9668&gt;</span>

<span class="gp">In [114]: </span><span class="n">s</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="gh">Out[114]: </span><span class="go">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f6589ac9668&gt;</span>
</pre></div>
</div>
<img alt="../_images/ewma_ex.png" src="../_images/ewma_ex.png" />
<p>EWM has a <code class="docutils literal notranslate"><span class="pre">min_periods</span></code> argument, which has the same
meaning it does for all the <code class="docutils literal notranslate"><span class="pre">.expanding</span></code> and <code class="docutils literal notranslate"><span class="pre">.rolling</span></code> methods:
no output values will be set until at least <code class="docutils literal notranslate"><span class="pre">min_periods</span></code> non-null values
are encountered in the (expanding) window.</p>
<p>EWM also has an <code class="docutils literal notranslate"><span class="pre">ignore_na</span></code> argument, which determines how
intermediate null values affect the calculation of the weights.
When <code class="docutils literal notranslate"><span class="pre">ignore_na=False</span></code> (the default), weights are calculated based on absolute
positions, so that intermediate null values affect the result.
When <code class="docutils literal notranslate"><span class="pre">ignore_na=True</span></code>,
weights are calculated by ignoring intermediate null values.
For example, assuming <code class="docutils literal notranslate"><span class="pre">adjust=True</span></code>, if <code class="docutils literal notranslate"><span class="pre">ignore_na=False</span></code>, the weighted
average of <code class="docutils literal notranslate"><span class="pre">3,</span> <span class="pre">NaN,</span> <span class="pre">5</span></code> would be calculated as</p>
<div class="math notranslate nohighlight">
\[\frac{(1-\alpha)^2 \cdot 3 + 1 \cdot 5}{(1-\alpha)^2 + 1}.\]</div>
<p>Whereas if <code class="docutils literal notranslate"><span class="pre">ignore_na=True</span></code>, the weighted average would be calculated as</p>
<div class="math notranslate nohighlight">
\[\frac{(1-\alpha) \cdot 3 + 1 \cdot 5}{(1-\alpha) + 1}.\]</div>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">var()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">std()</span></code>, and <code class="xref py py-meth docutils literal notranslate"><span class="pre">cov()</span></code> functions have a <code class="docutils literal notranslate"><span class="pre">bias</span></code> argument,
specifying whether the result should contain biased or unbiased statistics.
For example, if <code class="docutils literal notranslate"><span class="pre">bias=True</span></code>, <code class="docutils literal notranslate"><span class="pre">ewmvar(x)</span></code> is calculated as
<code class="docutils literal notranslate"><span class="pre">ewmvar(x)</span> <span class="pre">=</span> <span class="pre">ewma(x**2)</span> <span class="pre">-</span> <span class="pre">ewma(x)**2</span></code>;
whereas if <code class="docutils literal notranslate"><span class="pre">bias=False</span></code> (the default), the biased variance statistics
are scaled by debiasing factors</p>
<div class="math notranslate nohighlight">
\[\frac{\left(\sum_{i=0}^t w_i\right)^2}{\left(\sum_{i=0}^t w_i\right)^2 - \sum_{i=0}^t w_i^2}.\]</div>
<p>(For <span class="math notranslate nohighlight">\(w_i = 1\)</span>, this reduces to the usual <span class="math notranslate nohighlight">\(N / (N - 1)\)</span> factor,
with <span class="math notranslate nohighlight">\(N = t + 1\)</span>.)
See <a class="reference external" href="http://en.wikipedia.org/wiki/Weighted_arithmetic_mean#Weighted_sample_variance">Weighted Sample Variance</a>
on Wikipedia for further details.</p>
</div>
</div>


              </div>
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="visualization.html" title="previous page">Visualization</a>
    <a class='right-next' id="next-link" href="groupby.html" title="next page">Group By: split-apply-combine</a>

              </div>
              
          </main>

      </div>
    </div><script>
    // TOC sidebar - add "active" class to parent list
    //
    // Bootstrap's scrollspy adds the active class to the <a> link,
    // but for the automatic collapsing we need this on the parent list item.
    //
    // The event is triggered on "window" (and not the nav item as documented),
    // see https://github.com/twbs/bootstrap/issues/20086
    $(window).on("activate.bs.scrollspy", function(){
    var navLinks = document.querySelectorAll('#bd-toc-nav a');
    for (var i = 0; i < navLinks.length; i++) {
        var navLink = navLinks[i];
        navLink.parentElement.classList.remove('active');
    }
    var navLinks = document.querySelectorAll('#bd-toc-nav a.active');
    for (var i = 0; i < navLinks.length; i++) {
        var navLink = navLinks[i];
        navLink.parentElement.classList.add('active');
    }
    });

    /**
     * Use left and right arrow keys to navigate forward and backwards.
    */
    const LEFT_ARROW_KEYCODE = 37
    const RIGHT_ARROW_KEYCODE = 39

    const getPrevUrl = () => document.getElementById('prev-link').href
    const getNextUrl = () => document.getElementById('next-link').href
    const initPageNav = (event) => {
        const keycode = event.which

        if (keycode === LEFT_ARROW_KEYCODE) {
            window.location.href = getPrevUrl();
        } else if (keycode === RIGHT_ARROW_KEYCODE) {
            window.location.href = getNextUrl();
        }
    };

    var keyboardListener = false;
    $( document ).ready(() => {
        if (keyboardListener === false) {
            document.addEventListener('keydown', initPageNav)
            keyboardListener = true;
        }
    });
</script>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2020, the pandas development team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.0.
    </div>
  </body>
</html>